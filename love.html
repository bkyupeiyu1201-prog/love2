<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
  <meta charset="utf-8">
  <title>I love you</title>
  <style>
    html, body {
      height: 100%;
      padding: 0;
      margin: 0;
      background: #000;
      overflow: hidden;
    }
    canvas {
      position: absolute;
      width: 100%;
      height: 100%;
    }
    .love-text {
      position: absolute;
      top: 47%;
      width: 100%;
      text-align: center;
      font-family: "Segoe UI", "PingFang TC", "Microsoft JhengHei", sans-serif;
      font-size: clamp(18px, 4.5vw, 36px); /* 字體變小 */
      color: #fff;
      letter-spacing: 1.5px;
      text-shadow:
        0 0 8px #ea80b0,
        0 0 16px #ea80b0;
      z-index: 10;
      user-select: none;
      pointer-events: none;
    }
  </style>
</head>

<body>
  <div class="love-text">I love you</div>
  <canvas id="pinkboard"></canvas>

<script>
var settings = {
  particles: {
    length: 500,
    duration: 2,
    velocity: 100,
    effect: -0.75,
    size: 30,
  },
};

(function(){var b=0;var c=["ms","moz","webkit","o"];
for(var a=0;a<c.length&&!window.requestAnimationFrame;++a){
window.requestAnimationFrame=window[c[a]+"RequestAnimationFrame"];
window.cancelAnimationFrame=window[c[a]+"CancelAnimationFrame"]
||window[c[a]+"CancelRequestAnimationFrame"]}
if(!window.requestAnimationFrame){
window.requestAnimationFrame=function(h){
var d=new Date().getTime();
var f=Math.max(0,16-(d-b));
var g=window.setTimeout(function(){h(d+f)},f);
b=d+f;return g}}
if(!window.cancelAnimationFrame){
window.cancelAnimationFrame=function(d){clearTimeout(d)}}}());

var Point=function(x,y){this.x=x||0;this.y=y||0;};
Point.prototype.clone=function(){return new Point(this.x,this.y);};
Point.prototype.length=function(l){
if(l===undefined)return Math.sqrt(this.x*this.x+this.y*this.y);
this.normalize();this.x*=l;this.y*=l;return this;
};
Point.prototype.normalize=function(){
var l=this.length();this.x/=l;this.y/=l;return this;
};

var Particle=function(){
this.position=new Point();
this.velocity=new Point();
this.acceleration=new Point();
this.age=0;
};
Particle.prototype.initialize=function(x,y,dx,dy){
this.position.x=x;this.position.y=y;
this.velocity.x=dx;this.velocity.y=dy;
this.acceleration.x=dx*settings.particles.effect;
this.acceleration.y=dy*settings.particles.effect;
this.age=0;
};
Particle.prototype.update=function(dt){
this.position.x+=this.velocity.x*dt;
this.position.y+=this.velocity.y*dt;
this.velocity.x+=this.acceleration.x*dt;
this.velocity.y+=this.acceleration.y*dt;
this.age+=dt;
};
Particle.prototype.draw=function(ctx,img){
function ease(t){return(--t)*t*t+1;}
var size=img.width*ease(this.age/settings.particles.duration);
ctx.globalAlpha=1-this.age/settings.particles.duration;
ctx.drawImage(img,this.position.x-size/2,this.position.y-size/2,size,size);
};

var ParticlePool=function(len){
this.particles=new Array(len);
this.firstActive=0;
this.firstFree=0;
this.duration=settings.particles.duration;
for(var i=0;i<len;i++)this.particles[i]=new Particle();
};
ParticlePool.prototype.add=function(x,y,dx,dy){
this.particles[this.firstFree].initialize(x,y,dx,dy);
this.firstFree=(this.firstFree+1)%this.particles.length;
if(this.firstActive===this.firstFree)
this.firstActive=(this.firstActive+1)%this.particles.length;
};
ParticlePool.prototype.update=function(dt){
var i;
if(this.firstActive<this.firstFree){
for(i=this.firstActive;i<this.firstFree;i++)this.particles[i].update(dt);
}else{
for(i=this.firstActive;i<this.particles.length;i++)this.particles[i].update(dt);
for(i=0;i<this.firstFree;i++)this.particles[i].update(dt);
}
while(this.particles[this.firstActive].age>=this.duration
&&this.firstActive!==this.firstFree){
this.firstActive=(this.firstActive+1)%this.particles.length;
}
};
ParticlePool.prototype.draw=function(ctx,img){
var i;
if(this.firstActive<this.firstFree){
for(i=this.firstActive;i<this.firstFree;i++)this.particles[i].draw(ctx,img);
}else{
for(i=this.firstActive;i<this.particles.length;i++)this.particles[i].draw(ctx,img);
for(i=0;i<this.firstFree;i++)this.particles[i].draw(ctx,img);
}
};

(function(canvas){
var ctx=canvas.getContext("2d");
var pool=new ParticlePool(settings.particles.length);
var rate=settings.particles.length/settings.particles.duration;
var time;

function pointOnHeart(t){
return new Point(
160*Math.pow(Math.sin(t),3),
130*Math.cos(t)-50*Math.cos(2*t)-20*Math.cos(3*t)-10*Math.cos(4*t)+25
);
}

var img=(function(){
var c=document.createElement("canvas");
var ctx=c.getContext("2d");
c.width=c.height=settings.particles.size;
function to(t){
var p=pointOnHeart(t);
p.x=settings.particles.size/2+p.x*settings.particles.size/350;
p.y=settings.particles.size/2-p.y*settings.particles.size/350;
return p;
}
ctx.beginPath();
var t=-Math.PI,p=to(t);
ctx.moveTo(p.x,p.y);
while(t<Math.PI){t+=0.01;p=to(t);ctx.lineTo(p.x,p.y);}
ctx.closePath();
ctx.fillStyle="#ea80b0";
ctx.fill();
var img=new Image();
img.src=c.toDataURL();
return img;
})();

function resize(){
canvas.width=canvas.clientWidth;
canvas.height=canvas.clientHeight;
}
window.onresize=resize;

function render(){
requestAnimationFrame(render);
var now=Date.now()/1000;
var dt=now-(time||now);
time=now;
ctx.clearRect(0,0,canvas.width,canvas.height);
for(var i=0;i<rate*dt;i++){
var pos=pointOnHeart(Math.PI-2*Math.PI*Math.random());
var dir=pos.clone().length(settings.particles.velocity);
pool.add(canvas.width/2+pos.x,canvas.height/2-pos.y,dir.x,-dir.y);
}
pool.update(dt);
pool.draw(ctx,img);
}

setTimeout(function(){
resize();
render();
},10);
})(document.getElementById("pinkboard"));
</script>
</body>
</html>
